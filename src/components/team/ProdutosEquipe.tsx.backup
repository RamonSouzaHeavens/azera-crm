import React, { useState, useEffect, useCallback, useMemo } from 'react'
import { Plus, Loader, Image as ImageIcon, Filter, Grid3x3, List, Trash2 } from 'lucide-react'
import toast from 'react-hot-toast'
import { getProdutosEquipe, deleteProdutosSistema } from '../../services/produtosEquipeService'
import { isValidUrl } from '../../lib/urlValidation'
import { DetalhesImovelModal } from './DetalhesImovelModal'

interface Produto {
  id: string
  tenant_id: string
  nome: string
  descricao: string | null
  tipo: string | null
  valor: number | null
  preco?: number | null
  price?: number | null
  capa_url: string | null
  status: string
  destaque: boolean
  created_at: string
  ativo?: boolean
  area_total?: number | null
  area_construida?: number | null
  quartos?: number | null
  banheiros?: number | null
  vagas_garagem?: number | null
  endereco?: string | null
  bairro?: string | null
  cidade?: string | null
  cep?: string | null
  finalidade?: string | null
  filtros?: {
    empreendimento?: string
    incorporadora?: string
    fase?: string
    regiao?: string
    bairro?: string
    preco_min?: number
    metragem_min?: number
    metragem_max?: number
    tipologia?: string[]
    modalidade?: string[]
    financiamento_incorporadora?: boolean
    decorado?: boolean
  } | null
  tags?: string[] | null
}

interface ProdutosEquipeProps {
  tenantId: string
}

interface Filtros {
  tipo?: string | 'todos'
  finalidade?: string | 'todos'
  texto?: string
  valorMin?: number
  valorMax?: number
  quartos?: number
  banheiros?: number
  vagas?: number
  incorporadora?: string
  empreendimento?: string
  fase?: string
  regiao?: string
  bairro?: string
  tipologia?: string[]
  modalidade?: string
  financiamento_incorporadora?: 'any' | 'true' | 'false'
  decorado?: 'any' | 'true' | 'false'
}

// ============================
// Helpers
// ============================
const currencyBRL = (value: number): string => {
  return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })
}

const ProdutosEquipe: React.FC<ProdutosEquipeProps> = ({ tenantId }) => {
  const [produtos, setProdutos] = useState<Produto[]>([])
  const [loading, setLoading] = useState(true)
  const [filtros, setFiltros] = useState<Filtros>({ 
    tipo: 'todos', 
    finalidade: 'todos', 
    texto: '',
    financiamento_incorporadora: 'any',
    decorado: 'any'
  })
  const [filtrosOpen, setFiltrosOpen] = useState(false)
  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid')
  const [deletingSystem, setDeletingSystem] = useState(false)
  const [produtoSelecionado, setProdutoSelecionado] = useState<Produto | null>(null)
  const [modalAberto, setModalAberto] = useState(false)

  // Carregar produtos da equipe (refletindo produtos do propriet√°rio)
  const carregarProdutos = useCallback(async () => {
    try {
      setLoading(true)
      const data = await getProdutosEquipe(tenantId)
      setProdutos(data)
    } catch (error) {
      console.error('‚ùå Erro ao carregar produtos:', error)
      toast.error('Erro ao carregar produtos da equipe')
    } finally {
      setLoading(false)
    }
  }, [tenantId])

  // Deletar produtos do sistema
  const handleDeleteSystemProducts = useCallback(async () => {
    if (!window.confirm('Tem certeza que deseja deletar TODOS os produtos do sistema ([Sistema]...)? Esta a√ß√£o n√£o pode ser desfeita.')) {
      return
    }

    try {
      setDeletingSystem(true)
      const deletedCount = await deleteProdutosSistema(tenantId)
      toast.success(`${deletedCount} produto(s) do sistema deletado(s)!`)
      // Recarregar produtos
      await carregarProdutos()
    } catch (error) {
      console.error('Erro ao deletar produtos do sistema:', error)
      toast.error('Erro ao deletar produtos do sistema')
    } finally {
      setDeletingSystem(false)
    }
  }, [tenantId, carregarProdutos])

  useEffect(() => {
    carregarProdutos()
  }, [carregarProdutos])

  // Aplicar filtros
  const produtosFiltrados = useMemo(() => {
    // Primeiro, filtrar produtos do sistema
    let filtered = produtos.filter(p => !p.nome.startsWith('[Sistema]'))

    if (filtros.tipo && filtros.tipo !== 'todos') {
      filtered = filtered.filter(p => p.tipo === filtros.tipo)
    }

    if (filtros.finalidade && filtros.finalidade !== 'todos') {
      filtered = filtered.filter(p => p.finalidade === filtros.finalidade)
    }

    if (filtros.texto) {
      const texto = filtros.texto.toLowerCase()
      filtered = filtered.filter(p => 
        p.nome.toLowerCase().includes(texto) ||
        p.descricao?.toLowerCase().includes(texto) ||
        p.bairro?.toLowerCase().includes(texto) ||
        p.cidade?.toLowerCase().includes(texto)
      )
    }

    // Filtros num√©ricos
    if (filtros.valorMin) {
      filtered = filtered.filter(p => {
        const valor = p.valor || p.preco || p.price || p.filtros?.preco_min
        return valor ? Number(valor) >= filtros.valorMin! : false
      })
    }

    if (filtros.valorMax) {
      filtered = filtered.filter(p => {
        const valor = p.valor || p.preco || p.price || p.filtros?.preco_min
        return valor ? Number(valor) <= filtros.valorMax! : false
      })
    }

    if (filtros.quartos) {
      filtered = filtered.filter(p => p.quartos && p.quartos >= filtros.quartos!)
    }

    if (filtros.banheiros) {
      filtered = filtered.filter(p => p.banheiros && p.banheiros >= filtros.banheiros!)
    }

    if (filtros.vagas) {
      filtered = filtered.filter(p => p.vagas_garagem && p.vagas_garagem >= filtros.vagas!)
    }

    // Filtros de texto espec√≠ficos
    if (filtros.incorporadora) {
      filtered = filtered.filter(p => p.filtros?.incorporadora === filtros.incorporadora)
    }

    if (filtros.empreendimento) {
      filtered = filtered.filter(p => p.filtros?.empreendimento === filtros.empreendimento)
    }

    if (filtros.fase) {
      filtered = filtered.filter(p => p.filtros?.fase === filtros.fase)
    }

    if (filtros.modalidade) {
      filtered = filtered.filter(p => {
        const itemModalidades = p.filtros?.modalidade || []
        const searchModalidade = filtros.modalidade?.toLowerCase() || ''
        return itemModalidades.some(mod => mod.toLowerCase().includes(searchModalidade))
      })
    }

    if (filtros.regiao) {
      filtered = filtered.filter(p => p.filtros?.regiao === filtros.regiao)
    }

    if (filtros.bairro) {
      filtered = filtered.filter(p => 
        p.bairro === filtros.bairro || p.filtros?.bairro === filtros.bairro
      )
    }

    // Filtros booleanos
    if (filtros.financiamento_incorporadora && filtros.financiamento_incorporadora !== 'any') {
      const valorBool = filtros.financiamento_incorporadora === 'true'
      filtered = filtered.filter(p => p.filtros?.financiamento_incorporadora === valorBool)
    }

    if (filtros.decorado && filtros.decorado !== 'any') {
      const valorBool = filtros.decorado === 'true'
      filtered = filtered.filter(p => p.filtros?.decorado === valorBool)
    }

    // Filtros de array
    if (filtros.tipologia && filtros.tipologia.length > 0) {
      filtered = filtered.filter(p => 
        p.filtros?.tipologia?.some(t => filtros.tipologia!.includes(t))
      )
    }

    if (filtros.modalidade && filtros.modalidade.length > 0) {
      filtered = filtered.filter(p => 
        p.filtros?.modalidade?.some(m => filtros.modalidade!.includes(m))
      )
    }

    return filtered
  }, [produtos, filtros])

  // Op√ß√µes de filtro √∫nicas
  const tipos = useMemo(() => [...new Set(produtos.map(p => p.tipo).filter(Boolean))], [produtos])
  const finalidades = useMemo(() => [...new Set(produtos.map(p => p.finalidade).filter(Boolean))], [produtos])

  if (loading) {
    return (
      <div className="flex items-center justify-center py-12">
        <Loader className="w-6 h-6 text-slate-400 dark:text-slate-400 animate-spin" />
      </div>
    )
  }

  if (produtos.length === 0) {
    return (
      <div className="rounded-lg bg-slate-50 dark:bg-white/3 border border-slate-200 dark:border-white/10 p-12 text-center">
        <ImageIcon className="w-12 h-12 text-slate-400 dark:text-slate-500 mx-auto mb-4 opacity-50" />
        <h3 className="text-lg font-semibold text-slate-900 dark:text-white mb-2">Nenhum produto dispon√≠vel</h3>
        <p className="text-slate-600 dark:text-slate-400 mb-6">Os produtos do propriet√°rio aparecer√£o aqui automaticamente</p>
        <a
          href="/produtos"
          className="inline-flex items-center gap-2 px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 dark:bg-white dark:text-slate-900 dark:hover:bg-slate-50 transition-colors font-medium text-sm"
        >
          <Plus className="w-4 h-4" />
          Ir para Produtos
        </a>
      </div>
    )
  }

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="space-y-4">
        {/* Linha 1: T√≠tulo + Contador */}
        <div>
          <h2 className="text-lg font-semibold text-slate-900 dark:text-white">Produtos da Equipe</h2>
          <p className="text-sm text-slate-500 dark:text-slate-500">{produtosFiltrados.length} de {produtos.length} produto(s)</p>
        </div>

        {/* Linha 2: Bot√µes - Responsivo */}
        <div className="flex flex-wrap items-center gap-2 sm:gap-3">
          {/* Toggle View Mode */}
          <div className="flex items-center gap-1 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-xl p-1">
            <button
              onClick={() => setViewMode('grid')}
              className={`p-2 rounded-lg transition-all ${viewMode === 'grid' ? 'bg-cyan-500/20 text-cyan-600 dark:text-cyan-300' : 'text-slate-500 dark:text-gray-400 hover:text-slate-700 dark:hover:text-gray-200'}`}
              title="Visualiza√ß√£o em Grade"
            >
              <Grid3x3 className="w-4 h-4" />
            </button>
            <button
              onClick={() => setViewMode('list')}
              className={`p-2 rounded-lg transition-all ${viewMode === 'list' ? 'bg-cyan-500/20 text-cyan-600 dark:text-cyan-300' : 'text-slate-500 dark:text-gray-400 hover:text-slate-700 dark:hover:text-gray-200'}`}
              title="Visualiza√ß√£o em Lista"
            >
              <List className="w-4 h-4" />
            </button>
          </div>

          {/* Bot√µes de A√ß√£o - Encolhem no mobile */}
          <button
            onClick={() => setFiltrosOpen(!filtrosOpen)}
            className={`flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-xl border transition-all shadow-lg text-sm sm:text-sm font-medium ${filtrosOpen ? 'bg-cyan-50 dark:bg-gradient-to-r dark:from-cyan-500/20 dark:to-cyan-600/20 border-cyan-300 dark:border-cyan-400/30 text-cyan-700 dark:text-cyan-300 shadow-cyan-500/20' : 'bg-white dark:bg-white/5 border-slate-200 dark:border-white/10 text-slate-600 dark:text-gray-400 hover:text-slate-900 dark:hover:text-gray-200 hover:bg-slate-50 dark:hover:bg-white/10 hover:border-slate-300 dark:hover:border-white/20'}`}
          >
            <Filter className="w-4 h-4 flex-shrink-0" />
            <span className="hidden sm:inline">Filtros</span>
          </button>

          <button
            onClick={handleDeleteSystemProducts}
            disabled={deletingSystem}
            className="flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-xl border bg-white dark:bg-white/5 border-slate-200 dark:border-white/10 text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-500/10 hover:border-red-300 dark:hover:border-red-400/30 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-sm font-medium"
            title="Deletar produtos do sistema"
          >
            <Trash2 className="w-4 h-4 flex-shrink-0" />
            <span className="hidden sm:inline">{deletingSystem ? 'Deletando...' : 'Limpar'}</span>
          </button>
        </div>
      </div>

      {/* Filtros Modal */}
      {filtrosOpen && (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center p-0 sm:p-4">
          <div className="bg-slate-900/95 border border-slate-700/50 rounded-t-2xl sm:rounded-2xl shadow-2xl w-full sm:max-w-5xl max-h-[90vh] overflow-hidden flex flex-col">
            {/* Header */}
            <div className="bg-slate-900/95 border-b border-slate-700/50 px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between flex-shrink-0">
              <h3 className="text-lg font-semibold text-slate-200">Filtros</h3>
              <button
                onClick={() => setFiltrosOpen(false)}
                className="text-slate-400 hover:text-slate-200 transition-colors text-2xl leading-none w-8 h-8 flex items-center justify-center"
              >
                ‚úï
              </button>
            </div>

            {/* Content - Responsivo */}
            <div className="flex-1 overflow-y-auto p-4 sm:p-6">
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                {/* Coluna 1 */}
                <div className="space-y-4">
                  {/* Campo Buscar */}
                  <div>
                    <label className="text-xs text-slate-400 mb-2 block font-medium">Buscar</label>
                    <input
                      type="text"
                      value={filtros.texto || ''}
                      onChange={(e) => setFiltros({ ...filtros, texto: e.target.value })}
                      placeholder="Nome, localiza√ß√£o..."
                      className="w-full px-3 py-2.5 rounded-lg bg-slate-800/50 border border-slate-700 text-slate-200 placeholder-slate-500 text-sm focus:border-cyan-500 focus:outline-none focus:ring-1 focus:ring-cyan-500/30 transition-colors"
                    />
                  </div>

                  {/* Tipo e Finalidade */}
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="text-xs text-slate-400 mb-2 block font-medium">Tipo</label>
                      <select
                        value={filtros.tipo || 'todos'}
                        onChange={(e) => setFiltros({ ...filtros, tipo: e.target.value })}
                        className="w-full px-3 py-2.5 rounded-lg bg-slate-800/50 border border-slate-700 text-slate-200 text-sm focus:border-cyan-500 focus:outline-none focus:ring-1 focus:ring-cyan-500/30 transition-colors"
                      >
                        <option value="todos">Todos</option>
                        {tipos.map(tipo => (
                          <option key={tipo} value={tipo || ''}>{tipo && (tipo.charAt(0).toUpperCase() + tipo.slice(1))}</option>
                        ))}
                      </select>
                    </div>

                    <div>
                      <label className="text-xs text-slate-400 mb-2 block font-medium">Finalidade</label>
                      <select
                        value={filtros.finalidade || 'todos'}
                        onChange={(e) => setFiltros({ ...filtros, finalidade: e.target.value })}
                        className="w-full px-3 py-2.5 rounded-lg bg-slate-800/50 border border-slate-700 text-slate-200 text-sm focus:border-cyan-500 focus:outline-none focus:ring-1 focus:ring-cyan-500/30 transition-colors"
                      >
                        <option value="todos">Todas</option>
                        {finalidades.map(finalidade => (
                          <option key={finalidade} value={finalidade || ''}>{finalidade && finalidade.replace('_', ' ').toUpperCase()}</option>
                        ))}
                      </select>
                    </div>
                  </div>

                  {/* Valor M√≠nimo e M√°ximo */}
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="text-xs font-semibold text-slate-300 mb-2 block">Valor Min.</label>
                      <input
                        type="number"
                        value={filtros.valorMin || ''}
                        onChange={(e) => setFiltros({ ...filtros, valorMin: e.target.value ? Number(e.target.value) : undefined })}
                        placeholder="R$ 0"
                        className="w-full px-3 py-2.5 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-500 text-sm focus:border-cyan-400 focus:outline-none focus:ring-1 focus:ring-cyan-400/30 transition-colors"
                      />
                    </div>
                    <div>
                      <label className="text-xs font-semibold text-slate-300 mb-2 block">Valor Max.</label>
                      <input
                        type="number"
                        value={filtros.valorMax || ''}
                        onChange={(e) => setFiltros({ ...filtros, valorMax: e.target.value ? Number(e.target.value) : undefined })}
                        placeholder="R$ 999.999"
                        className="w-full px-3 py-2.5 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-500 text-sm focus:border-cyan-400 focus:outline-none focus:ring-1 focus:ring-cyan-400/30 transition-colors"
                      />
                    </div>
                  </div>

                  {/* Quartos, Banheiros e Vagas */}
                  <div className="grid grid-cols-3 gap-3">
                    <div>
                      <label className="text-xs font-semibold text-slate-300 mb-2 block">Quartos</label>
                      <input
                        type="number"
                        value={filtros.quartos || ''}
                        onChange={(e) => setFiltros({ ...filtros, quartos: e.target.value ? Number(e.target.value) : undefined })}
                        placeholder="Min"
                        className="w-full px-3 py-2.5 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-500 text-sm focus:border-cyan-400 focus:outline-none focus:ring-1 focus:ring-cyan-400/30 transition-colors"
                      />
                    </div>
                    <div>
                      <label className="text-xs font-semibold text-slate-300 mb-2 block">Banheiros</label>
                      <input
                        type="number"
                        value={filtros.banheiros || ''}
                        onChange={(e) => setFiltros({ ...filtros, banheiros: e.target.value ? Number(e.target.value) : undefined })}
                        placeholder="Min"
                        className="w-full px-3 py-2.5 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-500 text-sm focus:border-cyan-400 focus:outline-none focus:ring-1 focus:ring-cyan-400/30 transition-colors"
                      />
                    </div>
                    <div>
                      <label className="text-xs font-semibold text-slate-300 mb-2 block">Vagas</label>
                      <input
                        type="number"
                        value={filtros.vagas || ''}
                        onChange={(e) => setFiltros({ ...filtros, vagas: e.target.value ? Number(e.target.value) : undefined })}
                        placeholder="Min"
                        className="w-full px-3 py-2.5 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-500 text-sm focus:border-cyan-400 focus:outline-none focus:ring-1 focus:ring-cyan-400/30 transition-colors"
                      />
                    </div>
                  </div>
                </div>

                {/* Coluna 2 */}
                <div className="space-y-4">
                  <div>
                    <label className="text-xs font-semibold text-slate-300 mb-2 block">Incorporadora</label>
                    <input
                      type="text"
                      value={filtros.incorporadora || ''}
                      onChange={(e) => setFiltros({ ...filtros, incorporadora: e.target.value })}
                      placeholder="Ex: FG"
                      className="w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-500 text-sm focus:border-cyan-400 focus:outline-none transition-colors"
                    />
                  </div>

                  <div>
                    <label className="text-xs font-semibold text-slate-300 mb-2 block">Empreendimento</label>
                    <input
                      type="text"
                      value={filtros.empreendimento || ''}
                      onChange={(e) => setFiltros({ ...filtros, empreendimento: e.target.value })}
                      placeholder="Nome do empreendimento"
                      className="w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-500 text-sm focus:border-cyan-400 focus:outline-none transition-colors"
                    />
                  </div>

                  <div>
                    <label className="text-xs font-semibold text-slate-300 mb-2 block">Fase</label>
                    <input
                      type="text"
                      value={filtros.fase || ''}
                      onChange={(e) => setFiltros({ ...filtros, fase: e.target.value })}
                      placeholder="Ex: LAN√áAMENTO"
                      className="w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-500 text-sm focus:border-cyan-400 focus:outline-none transition-colors"
                    />
                  </div>

                  <div>
                    <label className="text-xs font-semibold text-slate-300 mb-2 block">Modalidade</label>
                    <input
                      type="text"
                      value={filtros.modalidade || ''}
                      onChange={(e) => setFiltros({ ...filtros, modalidade: e.target.value })}
                      placeholder="Ex: R2V, HMP, HIS2"
                      className="w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-500 text-sm focus:border-cyan-400 focus:outline-none transition-colors"
                    />
                  </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="text-xs font-semibold text-slate-300 mb-2 block">Regi√£o</label>
                    <input
                      type="text"
                      value={filtros.regiao || ''}
                      onChange={(e) => setFiltros({ ...filtros, regiao: e.target.value })}
                      placeholder="Ex: S√£o Paulo"
                      className="w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-500 text-sm focus:border-cyan-400 focus:outline-none transition-colors"
                    />
                  </div>
                  <div>
                    <label className="text-xs font-semibold text-slate-300 mb-2 block">Bairro</label>
                    <input
                      type="text"
                      value={filtros.bairro || ''}
                      onChange={(e) => setFiltros({ ...filtros, bairro: e.target.value })}
                      placeholder="Ex: Jardins"
                      className="w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-500 text-sm focus:border-cyan-400 focus:outline-none transition-colors"
                    />
                  </div>
                </div>

                  <div>
                    <label className="text-xs font-semibold text-slate-300 mb-2 block">Financiamento Incorporadora</label>
                    <select
                      value={filtros.financiamento_incorporadora || 'any'}
                      onChange={(e) => setFiltros({ ...filtros, financiamento_incorporadora: e.target.value as 'any' | 'true' | 'false' })}
                      className="w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm focus:border-cyan-400 focus:outline-none transition-colors"
                    >
                      <option value="any">Todos</option>
                      <option value="true">Sim</option>
                      <option value="false">N√£o</option>
                    </select>
                  </div>

                  <div>
                    <label className="text-xs font-semibold text-slate-300 mb-2 block">Decorado</label>
                    <select
                      value={filtros.decorado || 'any'}
                      onChange={(e) => setFiltros({ ...filtros, decorado: e.target.value as 'any' | 'true' | 'false' })}
                      className="w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm focus:border-cyan-400 focus:outline-none transition-colors"
                    >
                      <option value="any">Todos</option>
                      <option value="true">Sim</option>
                      <option value="false">N√£o</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            {/* Footer */}
            <div className="bg-slate-900/95 border-t border-slate-700/50 px-6 py-4 flex items-center justify-between">
              <button
                onClick={() => {
                  setFiltros({ tipo: 'todos', finalidade: 'todos', texto: '', financiamento_incorporadora: 'any', decorado: 'any' })
                }}
                className="px-4 py-2 text-sm text-slate-400 hover:text-slate-200 transition-colors"
              >
                Limpar Filtros
              </button>
              <button
                onClick={() => setFiltrosOpen(false)}
                className="px-6 py-2.5 bg-slate-700 text-slate-100 rounded-lg hover:bg-slate-600 transition-all font-medium text-sm"
              >
                Aplicar Filtros
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Grid ou Lista de Produtos */}
      <div className={viewMode === 'grid' ? 'grid grid-cols-1 lg:grid-cols-2 gap-6' : 'flex flex-col gap-4'}>
        {produtosFiltrados.map((produto) => (
          <div
            key={produto.id}
            className={`group rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-gradient-to-r dark:from-white/8 dark:to-white/5 hover:bg-slate-50 dark:hover:from-white/12 dark:hover:to-white/10 hover:border-cyan-300 dark:hover:border-cyan-400/40 transition-all shadow-lg hover:shadow-cyan-500/20 backdrop-blur-sm overflow-hidden ${viewMode === 'list' ? 'flex-row' : ''}`}
          >
            {viewMode === 'grid' ? (
              /* MODO GRID - Quadradinhos lado a lado */
              <div className="flex gap-5 p-5 flex-col md:flex-row md:items-start">
                {/* Imagem - 4:3 */}
                <div className="relative w-1/2 bg-gradient-to-br from-slate-900 to-slate-800 overflow-hidden flex-shrink-0 aspect-video">
                  <div className="w-full h-full">
                    {isValidUrl(produto.capa_url ?? '') ? (
                      <img 
                        src={produto.capa_url as string} 
                        alt={produto.nome} 
                        className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-[1.08]" 
                      />
                    ) : (
                      <div className="w-full h-full flex items-center justify-center text-slate-400 bg-gradient-to-br from-slate-800 to-slate-900">
                        <div className="text-center">
                          <ImageIcon className="w-12 h-12 mx-auto mb-2 opacity-50" />
                          <div className="text-xs text-gray-500">Sem imagem</div>
                        </div>
                      </div>
                    )}
                
                {/* Status Badge */}
                <div className="absolute top-3 left-3">
                  <span className={`text-[10px] sm:text-xs font-semibold px-3 py-1.5 rounded-full border backdrop-blur-md ${produto.status === 'disponivel' ? 'bg-emerald-500/20 border-emerald-400/50 text-emerald-200' : produto.status === 'reservado' ? 'bg-amber-500/20 border-amber-400/50 text-amber-200' : produto.status === 'vendido' ? 'bg-red-500/20 border-red-400/50 text-red-200' : 'bg-slate-500/20 border-slate-400/50 text-slate-200'}`}>
                    {produto.status?.replace('_', ' ').toUpperCase() || 'INDISPONIVEL'}
                  </span>
                </div>

                {/* Destaque Badge */}
                {produto.destaque && (
                  <div className="absolute top-3 right-3">
                    <span className="text-[10px] sm:text-xs font-bold px-3 py-1.5 rounded-full border border-purple-300/50 bg-gradient-to-r from-purple-500/30 to-pink-500/20 text-purple-100 backdrop-blur-md shadow-lg shadow-purple-500/20">
                      ‚≠ê DESTAQUE
                    </span>
                  </div>
                )}

                {/* A√ß√µes - aparecem no hover */}
                <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center gap-3">
                  <button
                    onClick={() => {
                      // TODO: Implementar edi√ß√£o
                      toast.error('Funcionalidade de edi√ß√£o ainda n√£o implementada')
                    }}
                    className="w-12 h-12 bg-white/20 hover:bg-white/30 rounded-xl flex items-center justify-center text-white hover:text-cyan-300 border border-white/30 backdrop-blur-sm transition-all hover:scale-110 shadow-lg"
                    title="Editar produto"
                  >
                    ‚úèÔ∏è
                  </button>
                  <button
                    onClick={() => {
                      if (window.confirm(`Tem certeza que deseja excluir o produto "${produto.nome}"?`)) {
                        // TODO: Implementar exclus√£o
                        toast.error('Funcionalidade de exclus√£o ainda n√£o implementada')
                      }
                    }}
                    className="w-12 h-12 bg-white/20 hover:bg-rose-500/40 rounded-xl flex items-center justify-center text-white hover:text-rose-200 border border-white/30 backdrop-blur-sm transition-all hover:scale-110 shadow-lg"
                    title="Excluir produto"
                  >
                    üóëÔ∏è
                  </button>
                </div>
              </div>
            </div>

            {/* Informa√ß√µes - 4:3 */}
            <div className="p-5 w-1/2 flex flex-col justify-between">
              <div className="flex items-start justify-between gap-3 mb-4">
                <div className="flex items-center gap-3 flex-1 min-w-0">
                  <div className="min-w-0">
                    <h3 className="font-bold text-slate-900 dark:text-white truncate text-lg leading-tight">{produto.nome}</h3>
                    {produto.filtros?.preco_min && (
                      <div className="text-emerald-600 dark:text-emerald-300 font-semibold text-sm mt-1">
                        A partir de {currencyBRL(typeof produto.filtros?.preco_min === 'string' ? Number(produto.filtros?.preco_min) : Number(produto.filtros?.preco_min))}
                      </div>
                    )}
                  </div>
                </div>
              </div>
              
              <p className="text-xs text-slate-600 dark:text-gray-400 line-clamp-2 mb-4 leading-relaxed">{produto.descricao ?? 'Sem descri√ß√£o dispon√≠vel'}</p>

              {/* Property Features Icons */}
              <div className="flex flex-wrap items-center gap-2 text-xs mb-5">
                {/* Basic property info always shown */}
                <div className="flex items-center gap-1 text-slate-700 dark:text-gray-300 bg-slate-50 dark:bg-white/5 px-2 py-1.5 rounded-lg border border-slate-200 dark:border-white/10">
                  <span className="text-xs">{produto.tipo?.charAt(0).toUpperCase() + produto.tipo?.slice(1) || 'Tipo n√£o informado'}</span>
                </div>
                
                {/* Property characteristics with icons */}
                {produto.area_total && (
                  <div className="flex items-center gap-1 text-slate-700 dark:text-gray-300 bg-slate-50 dark:bg-white/5 px-2 py-1.5 rounded-lg border border-slate-200 dark:border-white/10">
                    <span className="text-xs font-medium">{produto.area_total}m¬≤</span>
                  </div>
                )}
                
                {produto.quartos && (
                  <div className="flex items-center gap-1 text-slate-700 dark:text-gray-300 bg-slate-50 dark:bg-white/5 px-2 py-1.5 rounded-lg border border-slate-200 dark:border-white/10">
                    <span className="text-xs font-medium">{produto.quartos}</span>
                  </div>
                )}
                
                {produto.banheiros && (
                  <div className="flex items-center gap-1 text-slate-700 dark:text-gray-300 bg-slate-50 dark:bg-white/5 px-2 py-1.5 rounded-lg border border-slate-200 dark:border-white/10">
                    <span className="text-xs font-medium">{produto.banheiros}</span>
                  </div>
                )}
                
                {produto.vagas_garagem && (
                  <div className="flex items-center gap-1 text-slate-700 dark:text-gray-300 bg-slate-50 dark:bg-white/5 px-2 py-1.5 rounded-lg border border-slate-200 dark:border-white/10">
                    <span className="text-xs font-medium">{produto.vagas_garagem}</span>
                  </div>
                )}
              </div>

              {/* Informa√ß√µes do empreendimento */}
              {produto.filtros && (
                <div className="mt-4 space-y-2">
                  {/* Header - Empreendimento */}
                  {produto.filtros.empreendimento && (
                    <div className="pb-2 border-b border-slate-200 dark:border-white/10">
                      <div className="flex items-center gap-2">
                        <span className="text-xs font-semibold text-cyan-700 dark:text-cyan-200">{produto.filtros.empreendimento}</span>
                      </div>
                    </div>
                  )}

                  {/* Grid de informa√ß√µes */}
                  <div className="grid grid-cols-2 gap-2 text-xs">
                    {produto.filtros.incorporadora && (
                      <div className="flex items-center gap-1.5 bg-slate-100 dark:bg-white/5 rounded-lg p-2 border border-slate-300 dark:border-white/10">
                        <div>
                          <div className="text-slate-500 dark:text-gray-400 text-[10px]">Incorporadora</div>
                          <div className="font-semibold text-indigo-700 dark:text-indigo-200 line-clamp-1">{produto.filtros.incorporadora}</div>
                        </div>
                      </div>
                    )}

                    {produto.filtros.fase && (
                      <div className="flex items-center gap-1.5 bg-slate-100 dark:bg-white/5 rounded-lg p-2 border border-slate-300 dark:border-white/10">
                        <div>
                          <div className="text-slate-500 dark:text-gray-400 text-[10px]">Fase</div>
                          <div className="font-semibold text-emerald-700 dark:text-emerald-200 line-clamp-1">{produto.filtros.fase}</div>
                        </div>
                      </div>
                    )}

                    {produto.filtros.regiao && (
                      <div className="flex items-center gap-1.5 bg-slate-100 dark:bg-white/5 rounded-lg p-2 border border-slate-300 dark:border-white/10">
                        <div>
                          <div className="text-slate-500 dark:text-gray-400 text-[10px]">Regi√£o</div>
                          <div className="font-semibold text-amber-700 dark:text-amber-200 line-clamp-1">{produto.filtros.regiao}</div>
                        </div>
                      </div>
                    )}

                    {produto.filtros.bairro && (
                      <div className="flex items-center gap-1.5 bg-slate-100 dark:bg-white/5 rounded-lg p-2 border border-slate-300 dark:border-white/10">
                        <div>
                          <div className="text-slate-500 dark:text-gray-400 text-[10px]">Bairro</div>
                          <div className="font-semibold text-rose-900 dark:text-rose-200 line-clamp-1">{produto.filtros.bairro}</div>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Metragem e Entrega */}
                  <div className="grid grid-cols-2 gap-2 text-xs mt-2">
                    {(produto.filtros.metragem_min || produto.filtros.metragem_max) && (
                      <div className="flex items-center gap-1.5 bg-slate-100 dark:bg-white/5 rounded-lg p-2 border border-slate-300 dark:border-white/10">
                        <div>
                          <div className="text-slate-500 dark:text-gray-400 text-[10px]">Metragem</div>
                          <div className="font-semibold text-purple-700 dark:text-purple-200 line-clamp-1">
                            {produto.filtros.metragem_min && produto.filtros.metragem_max 
                              ? `${produto.filtros.metragem_min}-${produto.filtros.metragem_max}m¬≤`
                              : produto.filtros.metragem_min 
                                ? `Min ${produto.filtros.metragem_min}m¬≤`
                                : `Max ${produto.filtros.metragem_max}m¬≤`
                            }
                          </div>
                        </div>
                      </div>
                    )}

                    {produto.filtros.data_entrega && (
                      <div className="flex items-center gap-1.5 bg-slate-100 dark:bg-white/5 rounded-lg p-2 border border-slate-300 dark:border-white/10">
                        <div>
                          <div className="text-slate-500 dark:text-gray-400 text-[10px]">Entrega</div>
                          <div className="font-semibold text-rose-900 dark:text-rose-200 line-clamp-1">{produto.filtros.data_entrega}</div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Tipologia e Modalidade */}
              {produto.filtros && (produto.filtros.tipologia?.length || produto.filtros.modalidade?.length) && (
                <div className="mt-4 flex flex-wrap gap-2">
                  {produto.filtros.tipologia?.map((tip) => (
                    <span
                      key={`tipologia-${produto.id}-${tip}`}
                      className="inline-flex items-center gap-1 px-3 py-1.5 rounded-xl text-xs bg-cyan-500/15 border border-cyan-500/30 text-cyan-200"
                    >
                      <span>{tip}</span>
                    </span>
                  ))}
                  {produto.filtros.modalidade?.map((mod) => (
                    <span
                      key={`modalidade-${produto.id}-${mod}`}
                      className="inline-flex items-center gap-1 px-3 py-1.5 rounded-xl text-xs bg-fuchsia-500/15 border border-fuchsia-500/30 text-fuchsia-800"
                    >
                      <span>{mod}</span>
                    </span>
                  ))}
                </div>
              )}
            </div>
            {/* MODO LISTA - Layout Completo */}
            <div className="flex gap-5 p-5">
                {/* Imagem - 4:3 */}
                <div className="relative w-1/2 bg-gradient-to-br from-slate-900 to-slate-800 overflow-hidden flex-shrink-0 aspect-video">
                  <div className="w-full h-full">
                    {isValidUrl(produto.capa_url ?? '') ? (
                      <img 
                        src={produto.capa_url as string} 
                        alt={produto.nome} 
                        className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-[1.08]" 
                      />
                    ) : (
                      <div className="w-full h-full flex items-center justify-center text-slate-400 bg-gradient-to-br from-slate-800 to-slate-900">
                        <div className="text-center">
                          <ImageIcon className="w-12 h-12 mx-auto mb-2 opacity-50" />
                          <div className="text-xs text-gray-500">Sem imagem</div>
                        </div>
                      </div>
                    )}
                    
                    {/* Status Badge */}
                    <div className="absolute top-3 left-3">
                      <span className={`text-[10px] sm:text-xs font-semibold px-3 py-1.5 rounded-full border backdrop-blur-md ${produto.status === 'disponivel' ? 'bg-emerald-500/20 border-emerald-400/50 text-emerald-200' : produto.status === 'reservado' ? 'bg-amber-500/20 border-amber-400/50 text-amber-200' : produto.status === 'vendido' ? 'bg-red-500/20 border-red-400/50 text-red-200' : 'bg-slate-500/20 border-slate-400/50 text-slate-200'}`}>
                        {produto.status?.replace('_', ' ').toUpperCase() || 'INDISPONIVEL'}
                      </span>
                    </div>

                    {/* Destaque Badge */}
                    {produto.destaque && (
                      <div className="absolute top-3 right-3">
                        <span className="text-[10px] sm:text-xs font-bold px-3 py-1.5 rounded-full border border-purple-300/50 bg-gradient-to-r from-purple-500/30 to-pink-500/20 text-purple-100 backdrop-blur-md shadow-lg shadow-purple-500/20">
                          ‚≠ê DESTAQUE
                        </span>
                      </div>
                    )}

                    {/* A√ß√µes - aparecem no hover */}
                    <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center gap-3">
                      <button
                        onClick={() => {
                          // TODO: Implementar edi√ß√£o
                          toast.error('Funcionalidade de edi√ß√£o ainda n√£o implementada')
                        }}
                        className="w-12 h-12 bg-white/20 hover:bg-white/30 rounded-xl flex items-center justify-center text-white hover:text-cyan-300 border border-white/30 backdrop-blur-sm transition-all hover:scale-110 shadow-lg"
                        title="Editar produto"
                      >
                        ‚úèÔ∏è
                      </button>
                      <button
                        onClick={() => {
                          if (window.confirm(`Tem certeza que deseja excluir o produto "${produto.nome}"?`)) {
                            // TODO: Implementar exclus√£o
                            toast.error('Funcionalidade de exclus√£o ainda n√£o implementada')
                          }
                        }}
                        className="w-12 h-12 bg-white/20 hover:bg-rose-500/40 rounded-xl flex items-center justify-center text-white hover:text-rose-200 border border-white/30 backdrop-blur-sm transition-all hover:scale-110 shadow-lg"
                        title="Excluir produto"
                      >
                        üóëÔ∏è
                      </button>
                    </div>
                  </div>
                </div>

                {/* Informa√ß√µes - 4:3 */}
                <div className="p-5 w-1/2 flex flex-col justify-between">
                  <div className="flex items-start justify-between gap-3 mb-4">
                    <div className="flex items-center gap-3 flex-1 min-w-0">
                      <div className="min-w-0">
                        <h3 className="font-bold text-slate-900 dark:text-white truncate text-lg leading-tight">{produto.nome}</h3>
                        {produto.filtros?.preco_min && (
                          <div className="text-emerald-600 dark:text-emerald-300 font-semibold text-sm mt-1">
                            A partir de {currencyBRL(typeof produto.filtros?.preco_min === 'string' ? Number(produto.filtros?.preco_min) : Number(produto.filtros?.preco_min))}
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                  
                  <p className="text-xs text-slate-600 dark:text-gray-400 line-clamp-2 mb-4 leading-relaxed">{produto.descricao ?? 'Sem descri√ß√£o dispon√≠vel'}</p>

                  {/* Property Features Icons */}
                  <div className="flex flex-wrap items-center gap-2 text-xs mb-5">
                    {/* Basic property info always shown */}
                    <div className="flex items-center gap-1 text-slate-700 dark:text-gray-300 bg-slate-50 dark:bg-white/5 px-2 py-1.5 rounded-lg border border-slate-200 dark:border-white/10">
                      <span className="text-xs">{produto.tipo?.charAt(0).toUpperCase() + produto.tipo?.slice(1) || 'Tipo n√£o informado'}</span>
                    </div>
                    
                    {/* Property characteristics with icons */}
                    {produto.area_total && (
                      <div className="flex items-center gap-1 text-slate-700 dark:text-gray-300 bg-slate-50 dark:bg-white/5 px-2 py-1.5 rounded-lg border border-slate-200 dark:border-white/10">
                        <span className="text-xs font-medium">{produto.area_total}m¬≤</span>
                      </div>
                    )}
                    
                    {produto.quartos && (
                      <div className="flex items-center gap-1 text-slate-700 dark:text-gray-300 bg-slate-50 dark:bg-white/5 px-2 py-1.5 rounded-lg border border-slate-200 dark:border-white/10">
                        <span className="text-xs font-medium">{produto.quartos}</span>
                      </div>
                    )}
                    
                    {produto.banheiros && (
                      <div className="flex items-center gap-1 text-slate-700 dark:text-gray-300 bg-slate-50 dark:bg-white/5 px-2 py-1.5 rounded-lg border border-slate-200 dark:border-white/10">
                        <span className="text-xs font-medium">{produto.banheiros}</span>
                      </div>
                    )}
                    
                    {produto.vagas_garagem && (
                      <div className="flex items-center gap-1 text-slate-700 dark:text-gray-300 bg-slate-50 dark:bg-white/5 px-2 py-1.5 rounded-lg border border-slate-200 dark:border-white/10">
                        <span className="text-xs font-medium">{produto.vagas_garagem}</span>
                      </div>
                    )}
                  </div>

                  {/* Informa√ß√µes do empreendimento */}
                  {produto.filtros && (
                    <div className="mt-4 space-y-2">
                      {/* Header - Empreendimento */}
                      {produto.filtros.empreendimento && (
                        <div className="pb-2 border-b border-slate-200 dark:border-white/10">
                          <div className="flex items-center gap-2">
                            <span className="text-xs font-semibold text-cyan-700 dark:text-cyan-200">{produto.filtros.empreendimento}</span>
                          </div>
                        </div>
                      )}

                      {/* Grid de informa√ß√µes */}
                      <div className="grid grid-cols-2 gap-2 text-xs">
                        {produto.filtros.incorporadora && (
                          <div className="flex items-center gap-1.5 bg-slate-50 dark:bg-white/5 rounded-lg p-2 border border-slate-200 dark:border-white/10">
                            <div>
                              <div className="text-slate-500 dark:text-gray-400 text-[10px]">Incorporadora</div>
                              <div className="font-semibold text-indigo-700 dark:text-indigo-200 line-clamp-1">{produto.filtros.incorporadora}</div>
                            </div>
                          </div>
                        )}

                        {produto.filtros.fase && (
                          <div className="flex items-center gap-1.5 bg-slate-50 dark:bg-white/5 rounded-lg p-2 border border-slate-200 dark:border-white/10">
                            <div>
                              <div className="text-slate-500 dark:text-gray-400 text-[10px]">Fase</div>
                              <div className="font-semibold text-emerald-700 dark:text-emerald-200 line-clamp-1">{produto.filtros.fase}</div>
                            </div>
                          </div>
                        )}

                        {produto.filtros.regiao && (
                          <div className="flex items-center gap-1.5 bg-slate-50 dark:bg-white/5 rounded-lg p-2 border border-slate-200 dark:border-white/10">
                            <div>
                              <div className="text-slate-500 dark:text-gray-400 text-[10px]">Regi√£o</div>
                              <div className="font-semibold text-amber-700 dark:text-amber-200 line-clamp-1">{produto.filtros.regiao}</div>
                            </div>
                          </div>
                        )}

                        {produto.filtros.bairro && (
                          <div className="flex items-center gap-1.5 bg-slate-50 dark:bg-white/5 rounded-lg p-2 border border-slate-200 dark:border-white/10">
                            <div>
                              <div className="text-slate-500 dark:text-gray-400 text-[10px]">Bairro</div>
                              <div className="font-semibold text-rose-900 dark:text-rose-200 line-clamp-1">{produto.filtros.bairro}</div>
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Metragem e Entrega */}
                      <div className="grid grid-cols-2 gap-2 text-xs mt-2">
                        {(produto.filtros.metragem_min || produto.filtros.metragem_max) && (
                          <div className="flex items-center gap-1.5 bg-slate-50 dark:bg-white/5 rounded-lg p-2 border border-slate-200 dark:border-white/10">
                            <div>
                              <div className="text-slate-500 dark:text-gray-400 text-[10px]">Metragem</div>
                              <div className="font-semibold text-purple-700 dark:text-purple-200 line-clamp-1">
                                {produto.filtros.metragem_min && produto.filtros.metragem_max 
                                  ? `${produto.filtros.metragem_min}-${produto.filtros.metragem_max}m¬≤`
                                  : produto.filtros.metragem_min 
                                    ? `Min ${produto.filtros.metragem_min}m¬≤`
                                    : `Max ${produto.filtros.metragem_max}m¬≤`
                                }
                              </div>
                            </div>
                          </div>
                        )}

                        {produto.filtros.data_entrega && (
                          <div className="flex items-center gap-1.5 bg-slate-50 dark:bg-white/5 rounded-lg p-2 border border-slate-200 dark:border-white/10">
                            <div>
                              <div className="text-slate-500 dark:text-gray-400 text-[10px]">Entrega</div>
                              <div className="font-semibold text-rose-900 dark:text-rose-200 line-clamp-1">{produto.filtros.data_entrega}</div>
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* Tipologia e Modalidade */}
                  {produto.filtros && (produto.filtros.tipologia?.length || produto.filtros.modalidade?.length) && (
                    <div className="mt-4 flex flex-wrap gap-2">
                      {produto.filtros.tipologia?.map((tip) => (
                        <span
                          key={`tipologia-${produto.id}-${tip}`}
                          className="inline-flex items-center gap-1 px-3 py-1.5 rounded-xl text-xs bg-cyan-500/15 border border-cyan-500/30 text-cyan-200"
                        >
                          <span>{tip}</span>
                        </span>
                      ))}
                      {produto.filtros.modalidade?.map((mod) => (
                        <span
                          key={`modalidade-${produto.id}-${mod}`}
                          className="inline-flex items-center gap-1 px-3 py-1.5 rounded-xl text-xs bg-fuchsia-500/15 border border-fuchsia-500/30 text-fuchsia-800"
                        >
                          <span>{mod}</span>
                        </span>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            ) : (
              /* MODO GRID - Quadradinhos lado a lado */
              <div className="flex-1 flex flex-col gap-3">
              {/* Linha 1: T√≠tulo + Destaque */}
              <div className="flex items-center gap-3 flex-wrap">
                <h3 className="text-lg font-bold text-slate-900 dark:text-white truncate">{produto.nome}</h3>
                {produto.destaque && (
                  <span className="text-xs font-bold px-3 py-1.5 rounded-full border border-yellow-400 dark:border-yellow-300/50 bg-yellow-100 dark:bg-yellow-500/30 text-yellow-700 dark:text-yellow-100 backdrop-blur-md">
                    ‚≠ê DESTAQUE
                  </span>
                )}
              </div>

              {/* Pre√ßo destacado */}
              {(produto.valor || produto.preco || produto.price || produto.filtros?.preco_min) && (
                <div className="text-emerald-600 dark:text-emerald-300 font-bold text-xl mb-4">
                  {currencyBRL(Number(produto.valor || produto.preco || produto.price || produto.filtros?.preco_min || 0))}
                </div>
              )}

              {/* Grid de informa√ß√µes em quadradinhos */}
              <div className="grid grid-cols-2 gap-3 mb-4">
                {/* Tipo e Incorporadora na mesma linha */}
                <div className="grid grid-cols-2 gap-3 col-span-2">
                  {produto.tipo && (
                    <div className="flex flex-col items-center justify-center p-3 rounded-lg bg-slate-100 dark:bg-slate-500/10 border border-slate-300 dark:border-slate-500/30">
                      <span className="text-sm font-bold text-slate-900 dark:text-white">{produto.tipo.charAt(0).toUpperCase() + produto.tipo.slice(1)}</span>
                    </div>
                  )}

                  {produto.filtros?.incorporadora && (
                    <div className="flex flex-col items-center justify-center p-3 rounded-lg bg-cyan-100 dark:bg-cyan-500/10 border border-cyan-300 dark:border-cyan-500/30">
                      <span className="text-sm font-bold text-cyan-800 dark:text-cyan-300">{produto.filtros.incorporadora}</span>
                    </div>
                  )}
                </div>

                {/* √Årea Total */}
                {produto.area_total && (
                  <div className="flex flex-col items-center justify-center p-3 rounded-lg bg-indigo-100 dark:bg-indigo-500/10 border border-indigo-300 dark:border-indigo-500/30">
                    <span className="text-xs text-indigo-700 dark:text-indigo-300 mb-1">√Årea Total</span>
                    <span className="text-sm font-bold text-indigo-800 dark:text-indigo-300">{produto.area_total}m¬≤</span>
                  </div>
                )}

                {/* √Årea Constru√≠da */}
                {produto.area_construida && (
                  <div className="flex flex-col items-center justify-center p-3 rounded-lg bg-purple-100 dark:bg-purple-500/10 border border-purple-300 dark:border-purple-500/30">
                    <span className="text-xs text-purple-700 dark:text-purple-300 mb-1">Constru√≠da</span>
                    <span className="text-sm font-bold text-purple-800 dark:text-purple-300">{produto.area_construida}m¬≤</span>
                  </div>
                )}

                {/* Quartos, Banheiros e Vagas na mesma linha */}
                <div className="grid grid-cols-3 gap-3 col-span-2">
                  {produto.quartos && (
                    <div className="flex flex-col items-center justify-center p-3 rounded-lg bg-rose-100 dark:bg-rose-500/10 border border-rose-300 dark:border-rose-500/30">
                      <span className="text-lg mb-1">üõèÔ∏è</span>
                      <span className="text-sm font-bold text-rose-800 dark:text-rose-300">{produto.quartos}</span>
                    </div>
                  )}

                  {produto.banheiros && (
                    <div className="flex flex-col items-center justify-center p-3 rounded-lg bg-blue-100 dark:bg-blue-500/10 border border-blue-300 dark:border-blue-500/30">
                      <span className="text-lg mb-1">üöø</span>
                      <span className="text-sm font-bold text-blue-800 dark:text-blue-300">{produto.banheiros}</span>
                    </div>
                  )}

                  {produto.vagas_garagem && (
                    <div className="flex flex-col items-center justify-center p-3 rounded-lg bg-amber-100 dark:bg-amber-500/10 border border-amber-300 dark:border-amber-500/30">
                      <span className="text-lg mb-1">üöó</span>
                      <span className="text-sm font-bold text-amber-800 dark:text-amber-300">{produto.vagas_garagem}</span>
                    </div>
                  )}
                </div>

                {/* Fase e Data de entrega na mesma linha */}
                <div className="grid grid-cols-2 gap-3 col-span-2">
                  {produto.filtros?.fase && (
                    <div className="flex flex-col items-center justify-center p-3 rounded-lg bg-cyan-100 dark:bg-cyan-500/10 border border-cyan-300 dark:border-cyan-500/30">
                      <span className="text-xs text-cyan-700 dark:text-cyan-300 mb-1">Fase</span>
                      <span className="text-sm font-bold text-cyan-800 dark:text-cyan-300">{produto.filtros.fase}</span>
                    </div>
                  )}

                  {/* Data de entrega - se existir */}
                  {produto.filtros?.data_entrega && (
                    <div className="flex flex-col items-center justify-center p-3 rounded-lg bg-cyan-100 dark:bg-cyan-500/10 border border-cyan-300 dark:border-cyan-500/30">
                      <span className="text-xs text-cyan-700 dark:text-cyan-300 mb-1">Entrega</span>
                      <span className="text-sm font-bold text-cyan-800 dark:text-cyan-300">{produto.filtros.data_entrega}</span>
                    </div>
                  )}
                </div>
              </div>

              {/* Modalidade */}
              {produto.filtros?.modalidade && Array.isArray(produto.filtros.modalidade) && produto.filtros.modalidade.length > 0 && (
                <div className="flex flex-wrap gap-2 mb-3">
                  {produto.filtros.modalidade.map((mod, idx) => (
                    <span key={idx} className="px-2 py-1 rounded-lg bg-purple-100 dark:bg-purple-500/10 border border-purple-300 dark:border-purple-500/30 text-purple-800 dark:text-purple-300 text-xs font-bold">
                      {mod}
                    </span>
                  ))}
                </div>
              )}

              {/* Bot√£o minimalista */}
              <button
                onClick={() => {
                  setProdutoSelecionado(produto)
                  setModalAberto(true)
                }}
                className="w-full py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-500/30 hover:border-cyan-400/50 rounded-lg transition-all"
              >
                Ver detalhes
              </button>
              </div>
            )}
          </div>
        ))}
      </div>

      {/* Modal de Detalhes do Im√≥vel */}
      <DetalhesImovelModal
        produto={produtoSelecionado}
        isOpen={modalAberto}
        onClose={() => {
          setModalAberto(false)
          setProdutoSelecionado(null)
        }}
      />
    </div>
  )
}

export default ProdutosEquipe
